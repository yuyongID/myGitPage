<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Shell è®°å½• #  è®¡ç®—ç”¨å‘½ä»¤åˆ—è¡¨ #     å‘½ä»¤ æ„ä¹‰     sort -k1 -nr sort æ’åˆ—è®¡ç®—ï¼Œä¸å¸¦å‚æ•°ä¼šå°†å…ƒç´ å½’ç±»ï¼›-k1 ä»¥ç¬¬ä¸€åˆ—ä¸ºå…³é”®è¯ï¼›-nrçš„nä»£è¡¨å…³é”®è¯æ˜¯ number æ•°å­—ï¼Œr ä»£è¡¨ reverse å€’å™è¾“å‡ºã€‚   uniq -c uniq çœç•¥é‡å¤è¡Œã€‚-cä»£è¡¨è®¡æ•°   date +%d/%b/%Y:%H:%M Nginx æ—¥å¿—æ—¥æœŸæ ¼å¼çš„ dataï¼Œdate -d '-1 minute' +%d/%b/%Y:%H:%Må½“å‰æ—¶é—´çš„å‰ä¸€åˆ†é’Ÿ        AWK éœ€è¦è®°å½•çš„å†…å»ºå˜é‡ #     å˜é‡å æ„ä¹‰     $0 æ•´è¡Œçš„å†…å®¹   NR ä»1å¼€å§‹çš„è¡Œæ•°   OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼ŒOFS=&#34;\t&#34;è¾“å‡ºç”¨åˆ¶è¡¨ç¬¦æ¥åˆ†åˆ—   NF å½“å‰è®°å½•ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œå°±æ˜¯æœ‰å¤šå°‘åˆ—ã€‚$NF æœ€åä¸€åˆ—æ•°æ®    AWK æ­£åˆ™ä¸ grep çš„å¯¹æ¯” #  # ä¸‹é¢æ“ä½œç›¸ç­‰ grep &#34;TIME_WAIT&#34; netstat."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Shell è®°å½• #  è®¡ç®—ç”¨å‘½ä»¤åˆ—è¡¨ #     å‘½ä»¤ æ„ä¹‰     sort -k1 -nr sort æ’åˆ—è®¡ç®—ï¼Œä¸å¸¦å‚æ•°ä¼šå°†å…ƒç´ å½’ç±»ï¼›-k1 ä»¥ç¬¬ä¸€åˆ—ä¸ºå…³é”®è¯ï¼›-nrçš„nä»£è¡¨å…³é”®è¯æ˜¯ number æ•°å­—ï¼Œr ä»£è¡¨ reverse å€’å™è¾“å‡ºã€‚   uniq -c uniq çœç•¥é‡å¤è¡Œã€‚-cä»£è¡¨è®¡æ•°   date +%d/%b/%Y:%H:%M Nginx æ—¥å¿—æ—¥æœŸæ ¼å¼çš„ dataï¼Œdate -d '-1 minute' +%d/%b/%Y:%H:%Må½“å‰æ—¶é—´çš„å‰ä¸€åˆ†é’Ÿ        AWK éœ€è¦è®°å½•çš„å†…å»ºå˜é‡ #     å˜é‡å æ„ä¹‰     $0 æ•´è¡Œçš„å†…å®¹   NR ä»1å¼€å§‹çš„è¡Œæ•°   OFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼ŒOFS=&#34;\t&#34;è¾“å‡ºç”¨åˆ¶è¡¨ç¬¦æ¥åˆ†åˆ—   NF å½“å‰è®°å½•ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œå°±æ˜¯æœ‰å¤šå°‘åˆ—ã€‚$NF æœ€åä¸€åˆ—æ•°æ®    AWK æ­£åˆ™ä¸ grep çš„å¯¹æ¯” #  # ä¸‹é¢æ“ä½œç›¸ç­‰ grep &#34;TIME_WAIT&#34; netstat."><meta property="og:type" content="article"><meta property="og:url" content="https://yuyongid.github.io/myWiki/docs/shell/"><title>Shell | è£•ç”¨ Wiki</title><link rel=manifest href=/myWiki/manifest.json><link rel=icon href=/myWiki/favicon.png type=image/x-icon><link rel=stylesheet href=/myWiki/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/myWiki/en.search.min.5830e64da2a02796ed971818e8ca3fb87a9eb4d221d82fd477a25b244ab76981.js integrity="sha256-WDDmTaKgJ5btlxgY6Mo/uHqetNIh2C/Ud6JbJEq3aYE="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/myWiki><span>è£•ç”¨ Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/myWiki/docs/shell/ class=active>Shell</a></li><li class=book-section-flat><span>Docker</span><ul><li><a href=/myWiki/docs/docker/docker-learn/>Docker Learn</a></li></ul></li><li class=book-section-flat><span>go è¯­è¨€</span><ul><li><a href=/myWiki/docs/go-language/go-notes/>go è¯­è¨€ä¸€äº›ç¬”è®°</a></li><li><a href=/myWiki/docs/go-language/dev-rule/>é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™</a></li></ul></li><li class=book-section-flat><span>ç®—æ³•ä¸æ•°æ®ç»“æ„</span><ul><li><span>æ —å­ğŸŒ°</span><ul><li><a href=/myWiki/docs/arithmetic/example/binarytree/>äºŒå‰æ ‘ binary tree</a></li><li><a href=/myWiki/docs/arithmetic/example/bitoperation/>ä½è¿ç®— bit operation</a></li><li><a href=/myWiki/docs/arithmetic/example/hashmap/>å“ˆå¸Œè¡¨ hash map</a></li><li><a href=/myWiki/docs/arithmetic/example/string/>å­—ç¬¦ä¸² string</a></li><li><a href=/myWiki/docs/arithmetic/example/mathematics/>æ•°å­¦ mathematics</a></li><li><a href=/myWiki/docs/arithmetic/example/array/>æ•°ç»„ array</a></li><li><a href=/myWiki/docs/arithmetic/example/linkedlist/>é“¾è¡¨ linked list</a></li></ul></li><li><a href=/myWiki/docs/arithmetic/leetcoderanking/>é«˜é¢‘é¢˜ç›®</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/myWiki/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Shell</strong>
<label for=toc-control><img src=/myWiki/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#shell-è®°å½•>Shell è®°å½•</a><ul><li></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=shell-è®°å½•>Shell è®°å½•
<a class=anchor href=#shell-%e8%ae%b0%e5%bd%95>#</a></h2><h4 id=è®¡ç®—ç”¨å‘½ä»¤åˆ—è¡¨>è®¡ç®—ç”¨å‘½ä»¤åˆ—è¡¨
<a class=anchor href=#%e8%ae%a1%e7%ae%97%e7%94%a8%e5%91%bd%e4%bb%a4%e5%88%97%e8%a1%a8>#</a></h4><table><thead><tr><th align=left>å‘½ä»¤</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td align=left><code>sort -k1 -nr</code></td><td><code>sort</code> æ’åˆ—è®¡ç®—ï¼Œä¸å¸¦å‚æ•°ä¼šå°†å…ƒç´ å½’ç±»ï¼›<code>-k1</code> ä»¥ç¬¬ä¸€åˆ—ä¸ºå…³é”®è¯ï¼›<code>-nr</code>çš„<code>n</code>ä»£è¡¨å…³é”®è¯æ˜¯ number æ•°å­—ï¼Œ<code>r</code> ä»£è¡¨ reverse å€’å™è¾“å‡ºã€‚</td></tr><tr><td align=left><code>uniq -c</code></td><td><code>uniq</code> çœç•¥é‡å¤è¡Œã€‚<code>-c</code>ä»£è¡¨è®¡æ•°</td></tr><tr><td align=left><code>date +%d/%b/%Y:%H:%M</code></td><td>Nginx æ—¥å¿—æ—¥æœŸæ ¼å¼çš„ <code>data</code>ï¼Œ<code>date -d '-1 minute' +%d/%b/%Y:%H:%M</code>å½“å‰æ—¶é—´çš„å‰ä¸€åˆ†é’Ÿ</td></tr><tr><td align=left></td><td></td></tr></tbody></table><h4 id=awk-éœ€è¦è®°å½•çš„å†…å»ºå˜é‡>AWK éœ€è¦è®°å½•çš„å†…å»ºå˜é‡
<a class=anchor href=#awk-%e9%9c%80%e8%a6%81%e8%ae%b0%e5%bd%95%e7%9a%84%e5%86%85%e5%bb%ba%e5%8f%98%e9%87%8f>#</a></h4><table><thead><tr><th>å˜é‡å</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>$0</td><td>æ•´è¡Œçš„å†…å®¹</td></tr><tr><td>NR</td><td>ä»1å¼€å§‹çš„è¡Œæ•°</td></tr><tr><td>OFS</td><td>è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œ<code>OFS="\t"</code>è¾“å‡ºç”¨åˆ¶è¡¨ç¬¦æ¥åˆ†åˆ—</td></tr><tr><td>NF</td><td>å½“å‰è®°å½•ä¸­çš„å­—æ®µä¸ªæ•°ï¼Œå°±æ˜¯æœ‰å¤šå°‘åˆ—ã€‚<code>$NF</code> æœ€åä¸€åˆ—æ•°æ®</td></tr></tbody></table><h4 id=awk-æ­£åˆ™ä¸-grep-çš„å¯¹æ¯”>AWK æ­£åˆ™ä¸ grep çš„å¯¹æ¯”
<a class=anchor href=#awk-%e6%ad%a3%e5%88%99%e4%b8%8e-grep-%e7%9a%84%e5%af%b9%e6%af%94>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ä¸‹é¢æ“ä½œç›¸ç­‰</span>
grep <span style=color:#e6db74>&#34;TIME_WAIT&#34;</span> netstat.txt
awk <span style=color:#e6db74>&#39;/TIME_WAIT/&#39;</span> netstat.txt

<span style=color:#75715e># ä¸‹é¢æ“ä½œç›¸ç­‰</span>
grep -v <span style=color:#e6db74>&#34;TIME_WAIT&#34;</span> netstat.txt
awk <span style=color:#e6db74>&#39;!/TIME_WAIT/&#39;</span> netstat.txt

</code></pre></div><h4 id=è®¡ç®—å½“å‰æ–‡ä»¶å¤¹æ€»å¤§å°>è®¡ç®—å½“å‰æ–‡ä»¶å¤¹æ€»å¤§å°
<a class=anchor href=#%e8%ae%a1%e7%ae%97%e5%bd%93%e5%89%8d%e6%96%87%e4%bb%b6%e5%a4%b9%e6%80%bb%e5%a4%a7%e5%b0%8f>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ls -l | awk <span style=color:#e6db74>&#39;NR!=1{sum+=$5}END{print sum}&#39;</span>
</code></pre></div><h4 id=è®¡ç®—-nginx-æ—¥å¿—ä¸­-ip-æ•°é‡å‰å>è®¡ç®— nginx æ—¥å¿—ä¸­ ip æ•°é‡å‰å
<a class=anchor href=#%e8%ae%a1%e7%ae%97-nginx-%e6%97%a5%e5%bf%97%e4%b8%ad-ip-%e6%95%b0%e9%87%8f%e5%89%8d%e5%8d%81>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$1]++}END{for(i in a)print a[i]&#34; &#34;i}&#39;</span> access.log | sort -k1 -nr | head -10
awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> access.log |sort | uniq -c | sort -k1 -nr | head -10
</code></pre></div><h4 id=ç»Ÿè®¡æ—¥å¿—ä¸­è®¿é—®å¤§äº100æ¬¡çš„-ip>ç»Ÿè®¡æ—¥å¿—ä¸­è®¿é—®å¤§äº100æ¬¡çš„ IP
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%97%a5%e5%bf%97%e4%b8%ad%e8%ae%bf%e9%97%ae%e5%a4%a7%e4%ba%8e100%e6%ac%a1%e7%9a%84-ip>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$1]++}END{for(i in a)if{a[i]&gt;100 print a[i]&#34;, &#34;i}}&#39;</span> access.log
</code></pre></div><h4 id=ç»Ÿè®¡æŸæ—¶é—´æ®µå†…è®¿é—®æœ€å¤šçš„10ä¸ªip>ç»Ÿè®¡æŸæ—¶é—´æ®µå†…è®¿é—®æœ€å¤šçš„10ä¸ªIP
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%9f%90%e6%97%b6%e9%97%b4%e6%ae%b5%e5%86%85%e8%ae%bf%e9%97%ae%e6%9c%80%e5%a4%9a%e7%9a%8410%e4%b8%aaip>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;$4&gt;=&#34;[9/Apr/2016:00:00:01&#34; &amp;&amp; $4&lt;=&#34;[9/Apr/2016:23:59:59&#34; {a[$1]++}END{for(i in a)print a[i],i}&#39;</span> access.log |sort -k1 -nr|head -n10
</code></pre></div><h4 id=ç»Ÿè®¡æ¯ä¸ªurlè®¿é—®å†…å®¹çš„æ€»å¤§å°body_bytes_sent>ç»Ÿè®¡æ¯ä¸ªURLè®¿é—®å†…å®¹çš„æ€»å¤§å°ï¼ˆ$body_bytes_sentï¼‰
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%af%8f%e4%b8%aaurl%e8%ae%bf%e9%97%ae%e5%86%85%e5%ae%b9%e7%9a%84%e6%80%bb%e5%a4%a7%e5%b0%8fbody_bytes_sent>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$7]++;size[$7]+=$10}END{for(i in a)print a[i],size[i],i}&#39;</span> access.log
</code></pre></div><h4 id=ç»Ÿè®¡è®¿é—®çŠ¶æ€ç ä¸º404çš„ipåŠå‡ºç°æ¬¡æ•°>ç»Ÿè®¡è®¿é—®çŠ¶æ€ç ä¸º404çš„IPåŠå‡ºç°æ¬¡æ•°
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e8%ae%bf%e9%97%ae%e7%8a%b6%e6%80%81%e7%a0%81%e4%b8%ba404%e7%9a%84ip%e5%8f%8a%e5%87%ba%e7%8e%b0%e6%ac%a1%e6%95%b0>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{if($9~/404/)a[$1&#34; &#34;$9]++}END{for(i in a)print i,a[i]}&#39;</span> access.log
</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#shell-è®°å½•>Shell è®°å½•</a><ul><li></li></ul></li></ul></nav></aside></main></body></html>