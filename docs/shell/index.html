<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Shell 记录 #  计算用命令列表 #     命令 意义     sort -k1 -nr sort 排列计算，不带参数会将元素归类；-k1 以第一列为关键词；-nr的n代表关键词是 number 数字，r 代表 reverse 倒叙输出。   uniq -c uniq 省略重复行。-c代表计数   date +%d/%b/%Y:%H:%M Nginx 日志日期格式的 data，date -d '-1 minute' +%d/%b/%Y:%H:%M当前时间的前一分钟        AWK 需要记录的内建变量 #     变量名 意义     $0 整行的内容   NR 从1开始的行数   OFS 输出字段分隔符，OFS=&#34;\t&#34;输出用制表符来分列   NF 当前记录中的字段个数，就是有多少列。$NF 最后一列数据    AWK 正则与 grep 的对比 #  # 下面操作相等 grep &#34;TIME_WAIT&#34; netstat."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content><meta property="og:description" content="Shell 记录 #  计算用命令列表 #     命令 意义     sort -k1 -nr sort 排列计算，不带参数会将元素归类；-k1 以第一列为关键词；-nr的n代表关键词是 number 数字，r 代表 reverse 倒叙输出。   uniq -c uniq 省略重复行。-c代表计数   date +%d/%b/%Y:%H:%M Nginx 日志日期格式的 data，date -d '-1 minute' +%d/%b/%Y:%H:%M当前时间的前一分钟        AWK 需要记录的内建变量 #     变量名 意义     $0 整行的内容   NR 从1开始的行数   OFS 输出字段分隔符，OFS=&#34;\t&#34;输出用制表符来分列   NF 当前记录中的字段个数，就是有多少列。$NF 最后一列数据    AWK 正则与 grep 的对比 #  # 下面操作相等 grep &#34;TIME_WAIT&#34; netstat."><meta property="og:type" content="article"><meta property="og:url" content="https://yuyongid.github.io/myWiki/docs/shell/"><title>Shell | 裕用 Wiki</title><link rel=manifest href=/myWiki/manifest.json><link rel=icon href=/myWiki/favicon.png type=image/x-icon><link rel=stylesheet href=/myWiki/book.min.6cd8553a6854f4812343f0f0c8baca31271e686434f381fbe3c7226f66639176.css integrity="sha256-bNhVOmhU9IEjQ/DwyLrKMSceaGQ084H748cib2ZjkXY="><script defer src=/myWiki/en.search.min.5830e64da2a02796ed971818e8ca3fb87a9eb4d221d82fd477a25b244ab76981.js integrity="sha256-WDDmTaKgJ5btlxgY6Mo/uHqetNIh2C/Ud6JbJEq3aYE="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/myWiki><span>裕用 Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/myWiki/docs/shell/ class=active>Shell</a></li><li class=book-section-flat><span>Docker</span><ul><li><a href=/myWiki/docs/docker/docker-learn/>Docker Learn</a></li></ul></li><li class=book-section-flat><span>go 语言</span><ul><li><a href=/myWiki/docs/go-language/go-notes/>go 语言一些笔记</a></li><li><a href=/myWiki/docs/go-language/dev-rule/>面向对象设计原则</a></li></ul></li><li class=book-section-flat><span>算法与数据结构</span><ul><li><span>栗子🌰</span><ul><li><a href=/myWiki/docs/arithmetic/example/binarytree/>二叉树 binary tree</a></li><li><a href=/myWiki/docs/arithmetic/example/bitoperation/>位运算 bit operation</a></li><li><a href=/myWiki/docs/arithmetic/example/hashmap/>哈希表 hash map</a></li><li><a href=/myWiki/docs/arithmetic/example/string/>字符串 string</a></li><li><a href=/myWiki/docs/arithmetic/example/mathematics/>数学 mathematics</a></li><li><a href=/myWiki/docs/arithmetic/example/array/>数组 array</a></li><li><a href=/myWiki/docs/arithmetic/example/linkedlist/>链表 linked list</a></li></ul></li><li><a href=/myWiki/docs/arithmetic/leetcoderanking/>高频题目</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/myWiki/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Shell</strong>
<label for=toc-control><img src=/myWiki/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#shell-记录>Shell 记录</a><ul><li></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=shell-记录>Shell 记录
<a class=anchor href=#shell-%e8%ae%b0%e5%bd%95>#</a></h2><h4 id=计算用命令列表>计算用命令列表
<a class=anchor href=#%e8%ae%a1%e7%ae%97%e7%94%a8%e5%91%bd%e4%bb%a4%e5%88%97%e8%a1%a8>#</a></h4><table><thead><tr><th align=left>命令</th><th>意义</th></tr></thead><tbody><tr><td align=left><code>sort -k1 -nr</code></td><td><code>sort</code> 排列计算，不带参数会将元素归类；<code>-k1</code> 以第一列为关键词；<code>-nr</code>的<code>n</code>代表关键词是 number 数字，<code>r</code> 代表 reverse 倒叙输出。</td></tr><tr><td align=left><code>uniq -c</code></td><td><code>uniq</code> 省略重复行。<code>-c</code>代表计数</td></tr><tr><td align=left><code>date +%d/%b/%Y:%H:%M</code></td><td>Nginx 日志日期格式的 <code>data</code>，<code>date -d '-1 minute' +%d/%b/%Y:%H:%M</code>当前时间的前一分钟</td></tr><tr><td align=left></td><td></td></tr></tbody></table><h4 id=awk-需要记录的内建变量>AWK 需要记录的内建变量
<a class=anchor href=#awk-%e9%9c%80%e8%a6%81%e8%ae%b0%e5%bd%95%e7%9a%84%e5%86%85%e5%bb%ba%e5%8f%98%e9%87%8f>#</a></h4><table><thead><tr><th>变量名</th><th>意义</th></tr></thead><tbody><tr><td>$0</td><td>整行的内容</td></tr><tr><td>NR</td><td>从1开始的行数</td></tr><tr><td>OFS</td><td>输出字段分隔符，<code>OFS="\t"</code>输出用制表符来分列</td></tr><tr><td>NF</td><td>当前记录中的字段个数，就是有多少列。<code>$NF</code> 最后一列数据</td></tr></tbody></table><h4 id=awk-正则与-grep-的对比>AWK 正则与 grep 的对比
<a class=anchor href=#awk-%e6%ad%a3%e5%88%99%e4%b8%8e-grep-%e7%9a%84%e5%af%b9%e6%af%94>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 下面操作相等</span>
grep <span style=color:#e6db74>&#34;TIME_WAIT&#34;</span> netstat.txt
awk <span style=color:#e6db74>&#39;/TIME_WAIT/&#39;</span> netstat.txt

<span style=color:#75715e># 下面操作相等</span>
grep -v <span style=color:#e6db74>&#34;TIME_WAIT&#34;</span> netstat.txt
awk <span style=color:#e6db74>&#39;!/TIME_WAIT/&#39;</span> netstat.txt

</code></pre></div><h4 id=计算当前文件夹总大小>计算当前文件夹总大小
<a class=anchor href=#%e8%ae%a1%e7%ae%97%e5%bd%93%e5%89%8d%e6%96%87%e4%bb%b6%e5%a4%b9%e6%80%bb%e5%a4%a7%e5%b0%8f>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ls -l | awk <span style=color:#e6db74>&#39;NR!=1{sum+=$5}END{print sum}&#39;</span>
</code></pre></div><h4 id=计算-nginx-日志中-ip-数量前十>计算 nginx 日志中 ip 数量前十
<a class=anchor href=#%e8%ae%a1%e7%ae%97-nginx-%e6%97%a5%e5%bf%97%e4%b8%ad-ip-%e6%95%b0%e9%87%8f%e5%89%8d%e5%8d%81>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$1]++}END{for(i in a)print a[i]&#34; &#34;i}&#39;</span> access.log | sort -k1 -nr | head -10
awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> access.log |sort | uniq -c | sort -k1 -nr | head -10
</code></pre></div><h4 id=统计日志中访问大于100次的-ip>统计日志中访问大于100次的 IP
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%97%a5%e5%bf%97%e4%b8%ad%e8%ae%bf%e9%97%ae%e5%a4%a7%e4%ba%8e100%e6%ac%a1%e7%9a%84-ip>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$1]++}END{for(i in a)if{a[i]&gt;100 print a[i]&#34;, &#34;i}}&#39;</span> access.log
</code></pre></div><h4 id=统计某时间段内访问最多的10个ip>统计某时间段内访问最多的10个IP
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%9f%90%e6%97%b6%e9%97%b4%e6%ae%b5%e5%86%85%e8%ae%bf%e9%97%ae%e6%9c%80%e5%a4%9a%e7%9a%8410%e4%b8%aaip>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;$4&gt;=&#34;[9/Apr/2016:00:00:01&#34; &amp;&amp; $4&lt;=&#34;[9/Apr/2016:23:59:59&#34; {a[$1]++}END{for(i in a)print a[i],i}&#39;</span> access.log |sort -k1 -nr|head -n10
</code></pre></div><h4 id=统计每个url访问内容的总大小body_bytes_sent>统计每个URL访问内容的总大小（$body_bytes_sent）
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e6%af%8f%e4%b8%aaurl%e8%ae%bf%e9%97%ae%e5%86%85%e5%ae%b9%e7%9a%84%e6%80%bb%e5%a4%a7%e5%b0%8fbody_bytes_sent>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{a[$7]++;size[$7]+=$10}END{for(i in a)print a[i],size[i],i}&#39;</span> access.log
</code></pre></div><h4 id=统计访问状态码为404的ip及出现次数>统计访问状态码为404的IP及出现次数
<a class=anchor href=#%e7%bb%9f%e8%ae%a1%e8%ae%bf%e9%97%ae%e7%8a%b6%e6%80%81%e7%a0%81%e4%b8%ba404%e7%9a%84ip%e5%8f%8a%e5%87%ba%e7%8e%b0%e6%ac%a1%e6%95%b0>#</a></h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>awk <span style=color:#e6db74>&#39;{if($9~/404/)a[$1&#34; &#34;$9]++}END{for(i in a)print i,a[i]}&#39;</span> access.log
</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#shell-记录>Shell 记录</a><ul><li></li></ul></li></ul></nav></aside></main></body></html>